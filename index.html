<!DOCTYPE html>
<link rel="stylesheet" type="text/css" href="style.css"/>
<html>
<head>
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<title>Watching on Map</title>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">

            
          </ul>
        </div>
      </nav>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPyp9z3UwS-dVEjzz9ffarnFOgGCJkJ7k&callback=initMap">
</script>
<script>
var watchID; 
function getLocation()
{
    //  Vérification si navigateur compatible API geolocalisation
    if (navigator.geolocation)  // Supported
    {
        var positionOptions = {
            timeout : Infinity,
            maximumAge : 0,
            enableHighAccuracy : true,
        };
        // Pour obtenir la localisation
        navigator.geolocation.getCurrentPosition(getPosition, catchError, positionOptions);
    }
    else  // Si API non supporté
    {
        alert("Oop! This browser does not support HTML5 Geolocation.");
    }
}    
function watchLocation()
{
    //  Vérification si navigateur compatible API geolocalisation
    if (navigator.geolocation)  //Supporté
    {
        var positionOptions = {
            timeout : Infinity,
            maximumAge : 0,
            enableHighAccuracy : true,
        };
        // Obtenir la localisation à intervals réguliers
        watchID = navigator.geolocation.watchPosition(getPosition, catchError, positionOptions);
    }
    else  // Non supporté
    {
        alert("Oop! This browser does not support HTML5 Geolocation.");
    }
}
function stopWatch() 
{
    // On stoppe la localisation en continue
    navigator.geolocation.clearWatch(watchID);
}
function getPosition(position)
{
    var location = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
    var mapOptions = {
        zoom : 12,
        center : location,
        mapTypeId : google.maps.MapTypeId.ROADMAP
    };
    localStorage.setItem("latitude", position.coords.latitude)
    localStorage.setItem("longitude", position.coords.longitude)

    var lat = localStorage.latitude;
    var lon = localStorage.longitude;
    document.getElementById("lat").innerHTML=lat;
    document.getElementById("lon").innerHTML=lon;


    var map = new google.maps.Map(document.getElementById('map-holder'), mapOptions);
    var marker = new google.maps.Marker({
        position: location,
        title: 'Here I am!',
        map: map,
        animation: google.maps.Animation.DROP
    });
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({
        'latLng' : location
        }, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                if (results[1]) {
                    var options = {
                        content : results[1].formatted_address,
                        position : location
                    };
                    var popup = new google.maps.InfoWindow(options);
                    google.maps.event.addListener(marker, 'click', function() {
                        popup.open(map);
                    });
                } 
                else 
                {
                    alert('Pas de résultat');
                }
            } 
            else 
            {
                alert('Cela ne fonctionne pas en raison: ' + status);
            }
        });
}
function catchError(error) {
    switch(error.code) 
    {
        case error.TIMEOUT:
            alert("d'un temps d'attente trop long");
            break;
        case error.POSITION_UNAVAILABLE:
            alert("informations de localisation indisponibles");
            break;
        case error.PERMISSION_DENIED:
            alert("de la non autorisation à partager la localisation");
            break;    
        default:
            alert("d'une erreur incconue");
}
}
</script>

</head>
<body onload="getLocation()">
    
<div id="map-holder"></div>
<button onclick="watchLocation()">Se géolocaliser</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<button onclick="stopWatch()">Arrêter la localisation</button>
  <div id="lat">
</div>
  <div id="lon">
</div>
</body>
</html>
